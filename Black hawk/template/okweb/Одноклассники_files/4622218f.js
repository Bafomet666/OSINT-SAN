define("OK/registration/Registration",[],function(){return{activate:function(){var b=document.getElementById("login-nav");var c=document.getElementById("registrationContentBlock");var d=document.getElementById("loginContentBlock");var a=document.getElementById("enterHeader");var e=document.getElementById("registration");b.addEventListener("click",function(i){var h=(i.target===a)?d:c;var f=(i.target===a)?e:a;var g=(i.target===a)?c:d;f.classList.remove("__active");g.classList.add("invisible");i.target.classList.add("__active");h.classList.remove("invisible");OK.historyManager.replaceState(i.target.getAttribute("href"));i.preventDefault();});}};});define("OK/utils/utils",["jquery"],function(d){var c=d("#hook_Cfg_GwtExperimentsCfg");var f=c?OK.util.parseJSON(c.html()):{};var b=document.getElementById("pointerOverlay");function a(h,j){var i=false;if(b&&OK.css.hasClass(b,"__auto")){i=true;OK.css.removeClass(b,"__auto");}var g=document.elementFromPoint(h,j);if(i){OK.css.addClass(b,"__auto");}return g;}function e(l,h,k){var g=l.split(OK.navigation.SPLITER);for(var j=0;j<g.length;j++){if(k[j]){OK.hookModel.setHookContent(k[j],g[j]);}}}return{ajax:function(i,h){var k=i.data||{};h=h||function(l){if(OK.navigation.redirect){OK.navigation.redirect(l);}else{document.location.href=decodeURIComponent(l);}};k["gwt.requested"]=window.pageCtx.gwtHash;i.type=i.type||"POST";i.data=k;i.beforeSend=function(m,l){m.setRequestHeader("TKN",OK.tkn.get());};var g=d.Deferred();var j=d.ajax(i);j.done(function(l,p,o){var n=o.getResponseHeader("TKN");if(n){OK.tkn.set(n);}var m=o.getResponseHeader("Redirect-Location");if(m){h(m);g.reject(o,p,"Redirect");return;}g.resolve(l,p,o);});j.fail(function(l,n,m){g.reject(l,n,m);});return g;},updateBlockModelCallback:function(i,g,j){var h=j.getResponseHeader(OK.navigation.HEADER).split(",");e(i,g,h);},updateBlocks:e,gwtExperimentsCfg:f,encodeHtml:function(g){return d("<div/>").text(g).html();},isElementInViewport:function(g){var h=g.getBoundingClientRect();if(h.top<0||h.left<0||h.bottom>(window.innerHeight||document.documentElement.clientHeight)||h.right>(window.innerWidth||document.documentElement.clientWidth)){return false;}return(g.contains(a(h.left,h.top))||g.contains(a(h.right,h.top))||g.contains(a(h.right,h.bottom))||g.contains(a(h.left,h.bottom)));},isElementPartiallyInViewport:function(k,h){if(!h){return this.isElementInViewport(k);}var l=k.getBoundingClientRect(),g=Math.min(l.bottom,window.innerHeight||document.documentElement.clientHeight)-Math.max(0,l.top),i=Math.min(l.right,window.innerWidth||document.documentElement.clientWidth)-Math.max(0,l.left),j=k.offsetHeight,m=k.offsetWidth;return j*h<=g&&m*h<=i;}};});define("OK/capture",["OK/logger"],function(p){var m=document,e,b,q="h-mod",g="href",l="data-module",j="data-activate",d="activate",i="OK/",o=[],f=function(r){var u,s,t;if(r.id&&r.id.indexOf("hook_")===0){s=r.id.substr(5);t=s.substr(0,s.indexOf("_"));if(t!=="Block"){p.success("capture.gwt",t,e);}}u=r.firstChild;while(u){f(u);u=u.nextSibling;}},a=function(v){var t,r,s;try{t=Array.prototype.slice.call(v);}catch(u){s=v.length;if(s>0){t=new Array(s);for(r=0;r<s;r+=1){t[r]=v[r];}}else{t=[];}}return t;},k=function(r){var t=r.getAttribute(j)||d;return function s(v){var u;if(typeof v==="function"){u=new v(r.id);}else{u=v;}u[t](r);o.push(u);};},c=function(t,r){var u,s;r=i+r;u=k(t);if(require.defined(r)){s=require(r);u(s);}else{require([r],u);}},h=function(x){var y,A,r,u,z,v,t,s,w;x=x||m;y=x.getElementsByClassName(q);r=a(y);u=r.length;for(z=0;z<u;z+=1){t=r[z];s=t.getAttribute(l);if(s){c(t,s);}}if(b){A=x.getElementsByTagName("a");r=a(A);u=r.length;for(z=0;z<u;z+=1){t=r[z];w=t.getAttribute(g);if(w){for(v=0;v<b.length;v+=1){s=b[v];if(w&&(w.indexOf("cmd="+s)!==-1)){c(t,s);}}}}}if(e){f(x);}},n=function(r){if(m.readyState==="interactive"||m.readyState==="complete"){h(r);}else{m.addEventListener("DOMContentLoaded",h);}};return{activate:n,activateDocument:function(r,s){b=r;e=s;n();}};});define("OK/registration/Utils",["OK/utils/utils","OK/capture"],function(c,e){var b="data-";var g="st.r.";var f=document.getElementById("registrationContentBlock");var a=document.getElementById("generalErrorHook");var d=a.getAttribute("data-general");a.parentNode.removeChild(a);return{addSubmitHook:function(h,i){h.addEventListener("keyup",function(j){if(j.keyCode==13){i();}});},getAttributesFromHook:function(l,j){if(typeof l==="string"){l=document.getElementById(l);}var m={};for(var k=0;k<l.attributes.length;k++){var h=l.attributes[k];if(h.name.indexOf(b)==0){m[h.name.substring(b.length)]=h.value;}}if(j){l.parentNode.removeChild(l);}return m;},proceed:function(k){var j={};for(var h in k){j[g+h]=k[h];}var i={data:j,url:"/dk"};i.data["st.cmd"]="anonymMain";i.data.cmd="AnonymRegistration";c.ajax(i).done(function(m,l,n){if(m!=""){f.innerHTML=m;e.activate(f);}}).fail(function(m,o,n){if(n!="Redirect"){var l=document.getElementById("general-error");l.classList.remove("invisible");l.textContent=d;}});},toggleClass:function(i,h,j){if(j){i.classList.add(h);}else{i.classList.remove(h);}},hideFieldError:function(h,i){if(h){h.classList.remove("form_i__error");}if(i){i.classList.remove("invisible");}},showFieldError:function(j,k,i,h){if(i){i.textContent=h;}if(j){j.classList.add("form_i__error");}if(k){k.classList.add("invisible");}}};});define("OK/registration/enterPhone",["OK/registration/Utils"],function(a){return{activate:function(){var g=document.getElementById("country");var d=document.getElementById("phoneCode");var b=document.getElementById("phone");var c=document.getElementById("proceedRegistration");var f=function(){d.textContent=g.value;};g.addEventListener("change",f);g.addEventListener("input",f);var e=function(){var h=g.options[g.selectedIndex].getAttribute("data-id");var i={countryId:h,countryCode:g.value,phone:b.value,registrationAction:"ValidatePhoneNumber"};OK.cookie.clearCookie("_lastSmsForCodeTime","/");a.proceed(i);};c.addEventListener("click",e);a.addSubmitHook(b,e);}};});define("OK/registration/enterCode",["OK/registration/Utils"],function(a){return{activate:function(){var i=document.getElementById("backToEnterPhone");var d=document.getElementById("proceedRegistration");var e=document.getElementById("proceedRegistrationContainer");var j=document.getElementById("resendSmsCode");var k=document.getElementById("resendSmsCodeDisabled");var g=document.getElementById("resendSmsCodeContainer");var f=document.getElementById("smsCode");var b=k.value;j.classList.remove("__disabled");i.addEventListener("click",function(){var l={registrationAction:"BackToEnterPhone"};a.proceed(l);});var h=function(){var l={smsCode:f.value,registrationAction:"ValidateCode"};a.proceed(l);};d.addEventListener("click",h);a.addSubmitHook(f,function(){if(!e.classList.contains("invisible")){h();}});var c=function(){var m=parseInt(OK.cookie.readCookie("_lastSmsForCodeTime"),10);var n=Date.now();if(!m){m=n;OK.cookie.setCookie("_lastSmsForCodeTime",m,1,"/");}var o=Math.round((n-m)/1000);k.value=b.replace("%d",20-o);if(o<=20){k.classList.remove("invisible");j.classList.add("invisible");var l=window.setInterval(function(){n=Date.now();o=Math.round((n-m)/1000);if(o<=20){k.value=b.replace("%d",20-o);}else{window.clearInterval(l);k.classList.add("invisible");j.classList.remove("invisible");}},300);}else{k.classList.add("invisible");j.classList.remove("invisible");}};j.addEventListener("click",function(){var l={registrationAction:"ResendCode"};a.proceed(l);OK.cookie.clearCookie("_lastSmsForCodeTime","/");c();});f.addEventListener("keyup",function(){var l=(f.value=="");a.toggleClass(e,"invisible",l);a.toggleClass(g,"invisible",!l);});c();}};});define("OK/registration/chooseUser",["OK/registration/Utils"],function(a){return{activate:function(){var g=document.getElementById("itsNotMeButton");var b=document.getElementById("registrationContentBlock");var j=b.getElementsByClassName("chooseUserButton");var f=a.getAttributesFromHook("actionHook",true)["action"];var h=function(l){var k=l.target.getAttribute("data-value");var i={userId:k,registrationAction:"RecoverUser"};a.proceed(i);};var d=function(k){var i={registrationAction:f};a.proceed(i);};if(j){for(var c=0,e=j.length;c<e;c++){j[c].addEventListener("click",h);}}g.addEventListener("click",d);}};});define("OK/registration/authorize",["OK/registration/Utils"],function(a){return{activate:function(){var l=document.getElementById("proceed");var b=document.getElementById("enterPassword");var r=document.getElementById("enterLogin");if(r){var i=a.getAttributesFromHook("loginRestrictionsHook",true);var v=new RegExp(i["allowed-symbols-pattern"]);var y=i["min-length"];var w=document.getElementById("login-hint");var k=document.getElementById("login-form");var u=document.getElementById("login-error");var j=a.getAttributesFromHook("hookLoginMsg",true);var s=function(A){var B=r.value;if(!v.test(B)){a.showFieldError(k,w,u,j["invalid-characters"]);}else{if(!A){if(B==""){a.showFieldError(k,w,u,j.empty);}else{if(B.length<y){a.showFieldError(k,w,u,j["short"]);}else{a.hideFieldError(k,w);return true;}}}else{a.hideFieldError(k,w);return true;}}return false;};r.addEventListener("keyup",function(){s(true);});}var n=a.getAttributesFromHook("passwordRestrictionsHook",true);var e=n["min-length"];var m=new RegExp(n["allowed-symbols-pattern"]);var f=new RegExp(n["must-contain-pattern"]);var t=document.getElementById("password-error");var c=document.getElementById("password-form");var q=document.getElementById("password-indicator-container");var z=document.getElementById("password-rate");var d=z.getElementsByClassName("progress-rate_bar");var x=document.getElementById("password-indicator-hint");var p=a.getAttributesFromHook("hookPwdMsg",true);var g=function(D,C,B){z.className="progress-rate mt-2x "+D;if(C>0){for(var A=0;A<C;A++){d[A].classList.add("__full");}}if(C<3){for(A=C;A<d.length;A++){d[A].classList.remove("__full");}}a.toggleClass(c,"form_i__error",B);a.toggleClass(x,"reg_error_txt",B);};var h=function(A,B){if(t){a.toggleClass(c,"form_i__error",!B);t.parentNode.removeChild(t);a.toggleClass(q,"invisible",!B);}if(A==""){x.textContent=p.empty;g("",0,B);}else{if(!m.test(A)){g("__weak",3,true);x.textContent=p.invalid;}else{if(A.length<e||!f.test(A)){if(A.length<e&&!f.test(A)){g("__weak",1,true);}else{g("__normal",2,true);}if(A.length<e){x.textContent=p["short"];}else{x.textContent=p["must-contain"];}}else{x.textContent=p.ok;g("__strong",3,false);return true;}}}return false;};b.addEventListener("keyup",function(){h(b.value,true);});var o=function(){var B=true;if(r){B=s();}if(!h(b.value,true)||!B){return;}var A={password:b.value,registrationAction:"Authorize"};if(r){A.login=r.value;}a.proceed(A);};l.addEventListener("click",o);a.addSubmitHook(b,o);h(b.value,false);}};});define("b/registration",["require","OK/registration/Registration","OK/registration/Utils","OK/registration/enterPhone","OK/registration/enterCode","OK/registration/chooseUser","OK/registration/authorize"],function(a){a("OK/registration/Registration");a("OK/registration/Utils");a("OK/registration/enterPhone");a("OK/registration/enterCode");a("OK/registration/chooseUser");a("OK/registration/authorize");return function(){};});